version: 2

macros:
  - name: create_vue_dept_annee
    description: >
      Crée une vue filtrée des données BDTopo routes pour un département 
      et une année (millésime) spécifique.
    arguments:
      - name: annee
        type: integer
        description: "Année du millésime au format YYYY (par défaut: variable projet 'annee')"
      - name: dept
        type: string
        description: "Code du département sur 2 caractères (par défaut: variable projet 'dept')"

  - name: verifier_gestionnaire_bdtopo_lin
    description: >
      Extrait la liste unique des gestionnaires présents dans la BDTopo 
      pour une année et un département donné.
    arguments:
      - name: annee
        type: integer
        description: "Année des données (par défaut: variable projet 'annee'))"
      - name: dept
        type: string
        description: "Code du département sur 2 caractères (par défaut: variable projet 'dept'))"

  - name: comparer_gestionnaire_bdtopo_lin
    description: >
      Compare les gestionnaires présents dans la BDTopo entre deux années 
      pour un département donné.
    arguments:
      - name: annee1
        type: integer
        description: "Première année de comparaison"
      - name: annee2
        type: integer
        description: "Deuxième année de comparaison"
      - name: dept
        type: string
        description: "Code du département sur 2 caractères (par défaut: variable projet 'dept')"

  - name: verifier_nbpt_lgkm_lin
    description: >
      Calcule le nombre de points de comptage et la longueur totale linéarisée 
      pour un département donné.
    arguments:
      - name: annee
        type: integer
        description: "Année des données (par défaut: variable projet 'annee'))"
      - name: dept
        type: string
        description: "Code du département sur 2 caractères (par défaut: variable projet 'dept'))"

  - name: verifier_nature_bdtopo_lin
    description: >
      Identifie les tronçons dont la nature est inattendue (sentier, chemin, route empierrée) 
      et calcule leur longueur cumulée.
    arguments:
      - name: annee
        type: integer
        description: "Année des données (par défaut: variable projet 'annee'))"
      - name: dept
        type: string
        description: "Code du département sur 2 caractères (par défaut: variable projet 'dept')"

  - name: verifier_dept_limitrophe_lin
    description: >
      Retourne la liste des départements limitrophes au département spécifié, hors de la région NA.
      Cette liste est utilisée pour vérifier les comptages aux frontières départementales.
    arguments:
      - name: dept
        type: string
        description: "Code du département sur 2 caractères (par défaut: variable projet 'dept'))"

  - name: verifier_comptage_limitrophe_lin
    description: >
      Extrait les données de comptage des départements limitrophes (hors NA) à partir de la vue 
      des derniers comptages connus (TMJA et %PL).
    arguments:
      - name: annee
        type: integer
        description: "Année des données (par défaut: variable projet 'annee')"
      - name: dept
        type: string
        description: "Code du département sur 2 caractères (par défaut: variable projet 'dept')"

  - name: verifier_attr_modif_bdtopo_lin
    description: >
      Compare les attributs (importance, numero, obs_supl) des tronçons routiers d'un millésimes de la BDTopo avec le précédent
      là où des variation d'attribut ont été détectées (analyse de l'attribut attr_modif).
    arguments:
      - name: annee
        type: integer
        description: "Année des données (par défaut: variable projet 'annee')"
      - name: dept
        type: string
        description: "Code du département sur 2 caractères (par défaut: variable projet 'dept')"

  - name: update_nouveau_point_lin
    description: >
      Met à jour les des lignes BDTopo à partir d'un relevé manuel compris dans le fichier de seed (deptXX_update_nouveau_pt).
      Ne concerne que les lignes affectées à de nouveaux points de comptage (id_comptag non présent dans le millésime précédent).
      Permet l'affectation soit par id_ign (identifiant BdTopo) soit par id_simpli (identifiant interne OTR).
      Cette macro permet de prioriser les colonnes fournit manuellement dans le fichier de
      seed pour les lignes à réaffecter. Les lignes non présentes dans le seed conservent
      leurs valeurs originales de la BDTopo.
    arguments:
      - name: dept
        type: string
        description: "Code du département sur 2 caractères (par défaut: variable projet 'dept')"
      - name: annee
        type: integer
        description: "Année du millésime au format YYYY (par défaut: variable projet 'annee')"

  - name: update_modif_linearisation_lin
    description: >
      Met à jour la linéarisation des lignes BDTopo à partir de choix manuels compris dans le fichier de seed (deptXX_update_modif_linearisation).
      Concerne uniquement les modifications de linéarisation pour des points de comptage existants (id_comptag déjà présent dans le millésime précédent).
      s'appuie sur le résultat de la prise en compte des nouveaux points de comptage (voir macro [update_nouveau_point_lin](#update_nouveau_point_lin)).
      Cette macro modifie uniquement les identifiants de comptage (id_comptag) pour les lignes spécifiées dans le seed,
      tout en conservant toutes les autres valeurs originales du fichier de linearisation. Les lignes non présentes dans le seed
      conservent leurs attributs originaux.
    arguments:
      - name: dept
        type: string
        description: "Code du département sur 2 caractères (par défaut: variable projet 'dept')"
      - name: annee
        type: integer
        description: "Année du millésime au format YYYY (par défaut: variable projet 'annee')"

  - name: update_oubli_lin
    description: >
      Corrige les oublis de linéarisation des lignes BDTopo à partir de choix manuels compris dans le fichier de seed (deptXX_update_oubli_linearisation).
      Concerne uniquement la correction d'oublis pour des points de comptage existants : rattachement de lignes BdTopo qui auraient dû être incluses 
      dès la linéarisation initiale mais qui ont été omises. S'appuie sur le résultat de la modification de linéarisation 
      (voir macro [update_modif_linearisation_lin](#update_modif_linearisation_lin)).
      Cette macro ajoute les lignes oubliées en les rattachant au bon id_comptag, avec des valeurs standardisées :
      src_cpt='otv', coment_cpt='linearisation', obs_supl=null, obs_tmja=null, obs_pc_pl=null.
      Les lignes non présentes dans le seed conservent leurs attributs originaux.
    arguments:
      - name: dept
        type: string
        description: "Code du département sur 2 caractères (par défaut: variable projet 'dept')"
      - name: annee
        type: integer
        description: "Année du millésime au format YYYY (par défaut: variable projet 'annee')"

  - name: update_etirer_lin
    description: >
      Étire la linéarisation des lignes BDTopo à partir de choix manuels compris dans le fichier de seed (deptXX_update_etire_linearisation).
      Concerne l'extension de la linéarisation d'un point de comptage existant en y rattachant des lignes BdTopo supplémentaires (étirement de la zone couverte).
      S'appuie sur le résultat de la correction d'oublis de linéarisation 
      (voir macro [update_oubli_lin](#update_oubli_lin)).
      Cette macro ajoute les lignes supplémentaires en les rattachant au bon id_comptag, avec des valeurs standardisées :
      src_cpt='otv', coment_cpt='linearisation', obs_supl='linearisation etiree traf{annee}', obs_tmja=null, obs_pc_pl=null.
      Les lignes non présentes dans le seed conservent leurs attributs originaux.
    arguments:
      - name: dept
        type: string
        description: "Code du département sur 2 caractères (par défaut: variable projet 'dept')"
      - name: annee
        type: integer
        description: "Année du millésime au format YYYY (par défaut: variable projet 'annee')"